/*    v1. создает нули для каждого из штампов в эффекте Paint.        сперва нарисовать штампы, затем выделить слой, на котором рисовал и запустить скрипт.        выделяется только один слой.        v2. добавил проверку на уже имеющиеся нули с таким же именем.        теперь можно дублировать слой и рисовать по нему в текущей композиции. названия штампиков поменяется вместе с названием новых нулей.         выделенный слой блокируется выражением, что бы его нельзя было сместить.        на позиции нулика и эффекте "offset" сразу проставляются ключи.    v2.2 добавлен чекбокс для вкл/выкл прозрачности, нули теперь создаются не с начала слоя, а он текущего положения    v2.3 нулики создаются с того места, где начинаются штампики. теперь не важно в какое время запускать скрипт        v2.4 добавил слайдер для диаметра штампика*/function toNull (){    var selComp = app.project.activeItem;    if (!selComp) return;    var selLayers = selComp.selectedLayers;    if (selLayers.length != 1) {        alert("Слой не выбран, \rили выбрано больше одного");        return;    }    var effect = testEffect(selLayers);    if (!effect) return;    var numProp = effect.property("ADBE Paint Group").numProperties;        if (selLayers[0].threeDLayer) alert("Слой должен быть 2D")    else {        for (var i = 1; i <= numProp; i++){            var effPaint = effect.property("ADBE Paint Group").property(i);            var clonName = effPaint.name;            var clonPos = effPaint.property("ADBE Paint Properties").property("ADBE Paint Clone Position");            var pos = effPaint.property("ADBE Paint Transform").property("ADBE Paint Position");            var scale = effPaint.property("ADBE Paint Transform").property("ADBE Paint Scale");            var rot = effPaint.property("ADBE Paint Transform").property("ADBE Paint Rotation");            var op = effPaint.property("ADBE Paint Properties").property("ADBE Paint Opacity");            var shtampDiam = effPaint.property("ADBE Paint Properties").property("ADBE Paint Diameter");            /*            if (selLayers[0].source instanceof CompItem) var stTime = effPaint.property("ADBE Paint Duration").value[0]-selLayers[0]startTime;            else var stTime = selLayers[0].outPoint - effPaint.property("ADBE Paint Duration").value[1];            */            var stTime = effPaint.property("ADBE Paint Duration").value[0]-Math.abs(selLayers[0].startTime);            if (!testExpress(clonPos) || !testExpress(pos) || !testExpress(scale) || !testExpress(rot) || !testExpress(op)) {                var newNullName = testLayer(selComp, clonName, 0);                effect.property("ADBE Paint Group").property(i).name = newNullName;                var nLayer = createNull(selComp, selLayers, newNullName, clonPos.value, pos.value, stTime, shtampDiam.value);                clonPos.expression = "p=thisComp.layer(\"" + newNullName + "\");\rfromComp(p.toComp(p.anchorPoint)-[50,50]) + p.effect(\"offset\")(\"Point\")";                pos.expression = "p=thisComp.layer(\"" + newNullName + "\");\rfromComp(p.toComp(p.anchorPoint))";                scale.expression = "thisComp.layer(\"" + newNullName + "\").transform.scale";                rot.expression = "thisComp.layer(\"" + newNullName + "\").transform.rotation";                op.expression = "if ( thisComp.layer(\"" + newNullName + "\").effect(\"opacity\")(\"Checkbox\") == true) 100\relse 0";                shtampDiam.expression = "thisComp.layer(\"" + newNullName + "\").effect(\"Stamp Diameter\")(\"Slider\")";        }        var p = selLayers[0].transform.position;        p.expression = "[" + p.value[0] + "," + p.value[1] +"]";    }}function testEffect(layer) {    var effect = layer[0].property("ADBE Effect Parade");    for(var i = 1; i <= effect.numProperties; i++){        if(effect.property(i).matchName == "ADBE Paint") {            return effect.property(i);        }    }    alert ("Нет эффекта Paint");    return false;}function testExpress(_property) {    if (_property.expressionEnabled == true) return true;    else return false;}function createNull(_selComp,_selLayers, _name, _clonPos, _pos, _time, _diam) {        var newNull = _selComp.layers.addNull();        newNull.startTime = _time;        newNull.outPoint = _selLayers[0].outPoint;        newNull.source.name = _name;        var newPos = newNullPos(newNull, _pos, _selLayers);        newNull.transform.position.setValueAtTime(_time, newPos);        newNull.transform.anchorPoint.setValue([50,50]);        var effect = newNull.property("ADBE Effect Parade").addProperty("ADBE Point Control");        effect.name = "offset";        effect.property("ADBE Point Control-0001").setValueAtTime(_time, _clonPos - _pos + [50,50]);        effect.property("ADBE Point Control-0001").setInterpolationTypeAtKey(1, KeyframeInterpolationType.HOLD, KeyframeInterpolationType.HOLD);        var effectOp = newNull.property("ADBE Effect Parade").addProperty("ADBE Checkbox Control");        effectOp.name = "opacity";        effectOp.property("ADBE Checkbox Control-0001").setValueAtTime(_time, 1);        var effectDiam = newNull.property("ADBE Effect Parade").addProperty("ADBE Slider Control");        effectDiam.name = "Stamp Diameter";        effectDiam.property("ADBE Slider Control-0001").setValue(_diam);    }}function testLayer(_comp, _name, _num){    var n = _num + 1;    var nameN = _name;    for (var i = 1;  i <= _comp.numLayers; i += 1) {        var layName = _comp.layer(i).name;        if (layName == _name) {            var newName = _name + n;            nameN = testLayer(_comp, newName, n);        }    }    return nameN;}function newNullPos(_layer, _pos, _targetLayer){        var effect = _layer.property("ADBE Effect Parade").addProperty("ADBE Point Control");        effect.name = "tempPos";        var pointControl = effect.property("ADBE Point Control-0001");        pointControl.expression = "thisComp.layer(" + _targetLayer[0].index + ").toComp([" + _pos[0] + "," + _pos[1] + "])"        var newPos = pointControl.value;        effect.remove();        return newPos;}app.beginUndoGroup ("-=Shtamp to Null=-");toNull();app.endUndoGroup();